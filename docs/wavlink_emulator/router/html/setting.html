<div class="main row">
    <div class="col-xs-2 aside">
        <div class="panel-group" id="menu-list" role="tablist" aria-multiselectable="false">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <span data-i18n="lblRouterStatus"></span>
                    </h4>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="network-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#network" aria-expanded="false" aria-controls="network">
                        <span data-i18n="lblNetworkSetup"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="network" class="panel-collapse collapse" role="tabpanel" aria-labelledby="network-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="wan.html" data-i18n="tWanSetting"></a></li>
                            <li role="presentation"><a href="lan.html" data-i18n="tLanSetting"></a></li>
                            <li role="presentation"><a href="static_ip.html" data-i18n="lblStaticIp"></a></li>
                            <li role="presentation"><a href="ipv6.html" data-i18n="tIPv6Setting"></a></li>
                            <li role="presentation"><a href="vlan.html">IPTV/VLAN</a></li>
                            <li role="presentation"><a href="ddns.html" data-i18n="tDynamicDns"></a></li>
                            <li role="presentation"><a href="select_mode.html" data-i18n="lblModeSeclection"></a></li>
                            <li role="presentation"><a href="sqm_qos.html">SQM QoS</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="wireless-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#wireless" aria-expanded="false" aria-controls="wireless">
                        <span data-i18n="tWirelessMa"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="wireless" class="panel-collapse collapse" role="tabpanel" aria-labelledby="wireless-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="wifi_setting.html" data-i18n="tWfSetting"></a></li>
                            <li role="presentation"><a href="guest_wifi.html" data-i18n="lblGuestWiFi"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="mesh-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#mesh" aria-expanded="false" aria-controls="mesh">
                        <span data-i18n="lblmeshNetwork"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="mesh" class="panel-collapse collapse" role="tabpanel" aria-labelledby="mesh-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="mesh_list.html" data-i18n="lblMeshTable"></a></li>
                            <li role="presentation"><a href="mesh_topo.html" data-i18n="lblMeshGraph"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="guardian-setting">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#guardian" aria-expanded="false" aria-controls="guardian">
                        <span data-i18n="lblNetGuardian"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="guardian" class="panel-collapse collapse" role="tabpanel" aria-labelledby="guardian-setting">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="dns_server.html" data-i18n="lblCustomDNSServer"></a></li>
                            <li role="presentation"><a href="adguard.html">AdGuard Home</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="parent-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#parent" aria-expanded="false" aria-controls="parent">
                        <span data-i18n="tParentControl"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="parent" class="panel-collapse collapse" role="tabpanel" aria-labelledby="parent-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="wifi_schedule.html" data-i18n="tWifiSchedule"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="ai-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#aiNet" aria-expanded="false" aria-controls="aiNet">
                        <span data-i18n="">AI NET</span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="aiNet" class="panel-collapse collapse" role="tabpanel" aria-labelledby="ai-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="aiqoe.html">AI QoE</a></li>
                            <li role="presentation"><a href="parent_control.html" data-i18n="tParentControl"></a></li>
                            <li role="presentation"><a href="adblock.html" data-i18n="lblAdBlock"></a></li>
                            <li role="presentation"><a href="malwebblock.html" data-i18n="lblMalWebBlock"></a></li>
                            <li role="presentation"><a href="ark_db.html" data-i18n="lblArkDB"></a></li>
                            <li role="presentation"><a href="ark_status.html" data-i18n="lblArkStatus"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="forwarding-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#forwarding" aria-expanded="false" aria-controls="forwarding">
                        <span data-i18n="tNetForwarding"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="forwarding" class="panel-collapse collapse" role="tabpanel" aria-labelledby="forwarding-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="upnp.html">UPnP</a></li>
                            <li role="presentation"><a href="port_forward.html" data-i18n="lblPortForward"></a></li>
                            <li role="presentation"><a href="dmz.html">DMZ</a></li>
                            <li role="presentation"><a href="hwnat.html" data-i18n="tHwnatSetup"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="security-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#security" aria-expanded="false" aria-controls="security">
                        <span data-i18n="tSecurity"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="security" class="panel-collapse collapse" role="tabpanel" aria-labelledby="security-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="security.html" data-i18n="tFirewall"></a></li>
                            <li role="presentation"><a href="alg.html">ALG</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="vpn-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#vpn" aria-expanded="false" aria-controls="vpn">
                        <span>VPN</span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="vpn" class="panel-collapse collapse" role="tabpanel" aria-labelledby="vpn-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="openvpn_client.html" data-i18n="">OpenVPN Client</a></li>
                            <li role="presentation"><a href="openvpn_server.html" data-i18n="">OpenVPN Server</a></li>
                            <li role="presentation"><a href="wireguard_client.html" data-i18n="">WireGuard Client</a></li>
                            <li rolr="presentation"><a href="wireguard_server.html" data-i18n="">WireGuard Server</a></li>
                            <li role="presentation"><a href="vpn_client.html" data-i18n="tvpn_client"></a></li>
                            <li role="presentation"><a href="zerotier.html" data-i18n="">ZeroTier</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="usb-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#usb" aria-expanded="false" aria-controls="usb">
                        <span>USB</span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="usb" class="panel-collapse collapse" role="tabpanel" aria-labelledby="usb-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="usb_storage.html" data-i18n="tUsbStorage"></a></li>
                            <li role="presentation"><a href="usb_shareinternet.html" data-i18n="lblUsbShareInternet"></a></li>
                            <li role="presentation"><a href="usb_print.html" data-i18n="lblUsbPrintServer"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="access-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#access" aria-expanded="false" aria-controls="access">
                        <span data-i18n="tRemoteAccess"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="access" class="panel-collapse collapse" role="tabpanel" aria-labelledby="access-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="remote_access.html" data-i18n="lblRemoteAccess"></a></li>
                            <li role="presentation"><a href="wcloud_setting.html" data-i18n="lblWcloudOnOff"></a></li>
                            <li role="presentation"><a href="tr069.html" data-i18n="tr069_set"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default off">
                <div class="panel-heading" role="tab" id="tools-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#tools" aria-expanded="false" aria-controls="tools">
                        <span data-i18n="tNetTools"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="tools" class="panel-collapse collapse" role="tabpanel" aria-labelledby="tools-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="physical.html" data-i18n="lblPhysical"></a></li>
                            <li role="presentation"><a href="ping_or_tracert.html" data-i18n="tDiagnostics"></a></li>
                            <li role="presentation"><a href="wakeonelan.html" data-i18n="lblWakeOneLan"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="system-heading">
                    <h4 class="panel-title collapsed" data-toggle="collapse" data-parent="#menu-list" data-target="#system" aria-expanded="false" aria-controls="system">
                        <span data-i18n="lblSystemSetup"></span>
                        <img src="../img/down.png">
                    </h4>
                </div>
                <div id="system" class="panel-collapse collapse" role="tabpanel" aria-labelledby="system-heading">
                    <div class="panel-body">
                        <ul class="nav nav-stacked">
                            <li role="presentation"><a href="upgrade.html" data-i18n="tUpdate"></a></li>
                            <li role="presentation"><a href="set_safety.html" data-i18n="tChangeAthPwd"></a></li>
                            <li role="presentation"><a href="system_log.html" data-i18n="lblSystemLog"></a></li>
                            <li role="presentation"><a href="time_zone.html" data-i18n="tTimeZone"></a></li>
                            <li role="presentation"><a href="led.html" data-i18n="tLedSetup"></a></li>
                            <li role="presentation"><a href="backup_reset.html" data-i18n="tRestore"></a></li>
                            <li role="presentation"><a href="timing_reboot.html" data-i18n="tTimingReboot"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title-lg">
                        <span data-i18n="lblLogout" id="toLogout"></span>
                    </h4>
                </div>
            </div>
        </div>
    </div>
    <div id="page"></div>
</div>

<script>
    try{
        $;
    }catch(e){
        window.sessionStorage.setItem("page", "setting.html");
        window.location.replace("./index.html");
    }

    $(document).ready(function(){
        $("#toLogout").parent().show();

        ajax({
            url: "system.json",
            success: function(data) {
                if (data.error == 0) {
                    var func = data.function;
                    if (func.UsbEnSupport == 1) {
                        $("#usb-heading, [href='usb_storage.html'], [href='usb_print.html']").parent().show();
                    }
                    if (func.PingTracertShow == 1) {
                        $("#tools-heading, [href='ping_or_tracert.html']").parent().show();
                    }
                    switch (data.sys.opMode) {
                        case 0:
                            $("#mesh-heading, #vpn-heading, #guardian-setting, #forwarding-heading, #security-heading,\
                               #access-heading, #tools-heading").parent().show();
                            if (func.VlanShow == 1) {
                                $("[href='vlan.html']").parent().show();
                            }
                            if (func.wcloudenable == 1) {
                                $("[href='wcloud_setting.html']").parent().show();
                            }
                            if (func.VpnShowEnable == 1) {
                                $("#vpn,[href='vpn_client.html']").parent().show();
                            }
                            if (func.Tr069Show == 1) {
                                $("[href='tr069_setting.html']").parent().show();
                            }
                            if (func.UsbEnSupport == 1) {
                                $("[href='usb_shareinternet.html']").parent().show();
                            }
                            if (func.ZTSupport == 1) {
                                $("[href='zerotier.html']").parent().show();
                            }
                            if (func.AGHShow == 1) {
                                $("[href='adguard.html']").parent().show();
                            }
                            if (func.OpenVPNShow == 1) {
                                $("#vpn, [href='openvpn_client.html'], [href='openvpn_server.html']").parent().show();
                            }
                            if (func.WireGuardShow == 1) {
                                $("#vpn, [href='wireguard_client.html'], [href='wireguard_server.html']").parent().show();
                            }
                            if (func.SqmQosShow == 1) {
                                $("[href='sqm_qos.html']").parent().show();
                            }
                            if(func.QosShowEnable == 1) {

                            }
                            // ai
                            if (data.sys.model.includes("AI")) {
                                $("#aiNet, [href='aiqoe.html'], [href='parent_control.html'], [href='adblock.html'], [href='malwebblock.html'],\
                                   [href='ark_db.html'], [href='ark_status.html']").parent().show();
                            }
                            $("[href='select_mode.html'], [href='wan.html'], [href='lan.html'], [href='ipv6.html'],\
                               [href='static_ip.html'], [href='wifi_setting.html'], [href='guest_wifi.html'], [href='mesh_list.html'],\
                               [href='mesh_topo.html'], [href='wifi_schedule.html'], [href='block_site.html'], [href='security.html'],\
                               [href='remote_access.html'], [href='ddns.html'], [href='upnp.html'], [href='port_forward.html'],\
                               [href='dmz.html'], [href='hwnat.html'], [href='physical.html'], [href='alg.html'], [href='dns_server.html'],\
                               [href='time_zone.html'], [href='led.html'], [href='set_safety.html'], [href='backup_reset.html'],\
                               [href='upgrade.html'],[href='timing_reboot.html'], [href='wakeonelan.html'], [href='system_log.html']").parent().show();
                            break;
                        case 1:
                            $("#mesh-heading, #tools-heading, [href='select_mode.html'], [href='wifi_setting.html'], [href='guest_wifi.html'], [href='mesh_list.html'], \
                               [href='wifi_schedule.html'], [href='physical.html'], [href='time_zone.html'], [href='mesh_topo.html'], [href='led.html'],\
                               [href='set_safety.html'], [href='backup_reset.html'], [href='upgrade.html'], [href='timing_reboot.html'], [href='system_log.html']").parent().show();
                            break;
                        case 2:
                        case 3:
                            $("[href='upgrade.html']").attr("href", "repeaterupgrade.html");
                            $("[href='select_mode.html'], [href='wifi_setting.html'], [href='guest_wifi.html'], [href='wifi_schedule.html'], \
                               [href='time_zone.html'], [href='led.html'], [href='set_safety.html'], [href='backup_reset.html'], [href='system_log.html'], \
                               [href='timing_reboot.html'], [href='repeaterupgrade.html']").parent().show();
                            if (opMode == 3) {
                                $("[href='lan.html']").parent().show();
                            }
                            break;
                        default: break;
                    }
                } else {
                    locationUrl(data.error);
                }
            }
        });

        var nowPage = window.sessionStorage.getItem("page");
        nowPage = nowPage.indexOf("/setting/") == -1 ? "device_status.html" : nowPage.slice(9);

        // 点击左侧菜单，切换箭头
        $("#menu-list").on("click", ".panel-title", function(){
            var target = $(this);
            if (!target.attr("data-parent")) {
                $(".panel-title[aria-expanded='true']").click();
                changeSettingPage(target, "device_status.html");
            } else {
                $(".panel-title > img[src*='up']").attr("src", function(i,v){return v.replace("up", "down")});
                target.find("img:last-child").attr("src", function(i,v){
                    return target.hasClass("collapsed") ? v.replace("down", "up") : v.replace("up", "down");
                });
            }
        });

        $("#toLogout").on("click", function(){
            toPage("login", 0);
        });

        // 点击左侧菜单，右侧切换对应的内容
        $("#menu-list").on("click", "a", function(e){
            e.preventDefault();
            var target = $(this), page = target.attr("href");
            changeSettingPage(target, page);
        });

        if (nowPage && nowPage.indexOf("device_status") == -1) {
            var target = $("[href='"+nowPage+"']");
            target.parents(".panel-default").find(".panel-title").click();
            target.click();
        } else {
            $(".panel-title:first").click();
        }

        function changeSettingPage(target, page) {
            var icon = page.indexOf("device_status") != -1 ? target : target.parents(".panel-default");

            $("#menu-list .active").removeClass("active");
            $("#menu-list .panel-title > img[src*='_on']").attr("src", function(i,v){return v.replace("_on", "_off")});

            target.parent().addClass("active");
            icon.find("img:eq(0)").attr("src", function(i,v){return v.replace("_off", "_on");});

            console.log(page);
            $.loadPage("#page", page);
            window.sessionStorage.setItem("page", "/setting/"+page);
        }
    });
</script>
