<div class="page-content row">
    <div class="col-xs-9 content" id="adBlock">
        <div class="form-group row">
            <label class="col-xs-8 control-label" data-i18n="lblEnableMalWebBlock"></label>
            <div class="col-xs-4 text-right">
                <div class="switch">
                    <input class="switch-checkbox hidden" id="enableMalBlock" type="checkbox">
                    <label class="switch-label" for="enableMalBlock">
                        <span class="switch-inner"></span>
                    </label>
                </div>
            </div>
        </div>
        <h5 class="depart-line" data-i18n="lblBlockLog"></h5>
        <div id="malBlockInfo">
            <div class="per-page row">
                <div class="col-xs-9">
                    <span data-i18n="lblDisplayPerPage"></span>
                    <div class="dropdown select selectPerPage">
                        <input type="hidden" class="perPage" value="10">
                        <button class="form-control dropdown-toggle" data-toggle="dropdown">10</button>
                        <ul class="dropdown-menu" role="menu">
                            <li data-value="10">10</li>
                            <li data-value="15">15</li>
                            <li data-value="20">20</li>
                        </ul>
                    </div>
                </div>
                <div class="col-xs-3">
                    <button class="btn btn-primary theme-bg-color refresh" data-i18n="msgReload"></button>
                </div>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th data-i18n="lblTime"></th>
                        <th data-i18n="lblDeviceMAC"></th>
                        <th data-i18n="lblContent"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="3"><img src="../public/static/layer/skin/default/loading-2.gif" width="20px"></td></tr>
                </tbody>
            </table>
            <div class="pagination-box">
                <span data-i18n="lblTableFooter"></span>
                <ul class="pagination">
                    <li><span class="startPage" aria-label="Start" aria-hidden="true">&laquo;</span></li>
                    <li><span class="prevPage" aria-label="Previous" aria-hidden="true">&lt;</span></li>
                    <li class="active"><span class="nowPage">1</span></li>
                    <li><span class="nextPage" aria-label="Next" aria-hidden="true">&gt;</span></li>
                    <li><span class="endPage" aria-label="End" aria-hidden="true">&raquo;</span></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-xs-3 help">
        <h4 data-i18n="lblHelp"></h4>
        <h5 data-i18n="lblMalWebBlock"></h5>
    </div>
</div>

<script>
    try{
        $;
    }catch(e){
        window.sessionStorage.setItem("page", "/setting/malwebblock.html");
        window.location.replace("./index.html");
    }

    $(document).ready(function(){
        getBlockLog();

        $("#malBlockInfo .refresh").on("click", function(){
            $("#malBlockInfo .table > tbody").html("<tr><td colspan='3'><img src='../public/static/layer/skin/default/loading-2.gif' width='20px'></td></tr>");
            getBlockLog();
        });

        $("#enableMalBlock").on("change", function(){
            var enable = $(this).val();
            startLoading(2000, $.t("btnSaveName"));
        });

        function getBlockLog() {
            ajax({
                url: "ai.json",
                success: function(data) {
                    if (data.error == 0) {
                        $("#enableMalBlock").prop("checked", data.mal.enable == 1).val(data.mal.enable);
                        var logList = data.mal.log.map(function(v){
                            var time = new Date(v.time);
                            v.time = time.getFullYear()+"/"+(time.getMonth()+1).toString().padStrStart(2)+"/"+time.getDate().toString().padStrStart(2)+" "
                                     +time.getHours().toString().padStrStart(2)+":"+time.getMinutes().toString().padStrStart(2)+":"
                                     +time.getSeconds().toString().padStrStart(2);
                            return v;
                        });
                        $("#malBlockInfo").initTable(logList);
                    } else {
                        locationUrl(data.error);
                    }
                }
            });
        }
    });
</script>
